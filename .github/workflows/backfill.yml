name: Patch Missing Dates (Hole Fixer)

on:
  workflow_dispatch:

jobs:
  patch-holes:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 1 # ì•ˆì „í•˜ê²Œ í•˜ë£¨ì¹˜ì”© ìˆœì„œëŒ€ë¡œ
      fail-fast: false
      matrix:
        target_date:
          # 2ì›” 14ì¼ ~ 2ì›” 18ì¼ ë¹µê¾¸ë‚œ ë‚ ì§œ ì¡±ì§‘ê²Œ ìˆ˜ì§‘!
          - "2026-02-14"
          - "2026-02-15"
          - "2026-02-16"
          - "2026-02-17"
          - "2026-02-18"

    env:
      TZ: Asia/Seoul
      DATABASE_URL: ${{ secrets.DATABASE_URL }}
      NAVER_ADS_API_KEY: ${{ secrets.NAVER_ADS_API_KEY }}
      NAVER_ADS_SECRET: ${{ secrets.NAVER_ADS_SECRET }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests python-dotenv sqlalchemy psycopg2-binary pandas openpyxl

      - name: Run Hole Fixer
        run: |
          echo "ğŸš€ ë¹µê¾¸ë‚œ ë‚ ì§œ ìˆ˜ì§‘ ì‹œì‘: ${{ matrix.target_date }}"
          python collector.py --date ${{ matrix.target_date }} --skip_dim --workers 10
